<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Roasting Foto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://roastgram.xyz/css/style.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Radio+Canada+Big:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    </head>
<body class="min-vh-100 bg-white">
    <main class="container my-5">
        <h1 class="mx-3 fw-bold f500 lh-2">Ubah Foto Biasa Jadi Bahan Roasting yang Menghibur!</h1>
        
        <form class="mt-4 mx-3">
            <div class="mb-3">
                <label for="photo" class="form-label f400">Pilih gambar yang mau di roasting</label>
                <div class="input-group">
                    <input
                        type="file"
                        accept="image/jpeg, image/jpg, image/png, image/webm"
                        class="form-control p-4"
                        id="photo"
                        required
                    />
                </div>
                <div class="mt-2" id="fileName">Belum ada file yang dipilih</div>
            </div>
            <button type="submit" class="btn btn-danger w-100 p-3 f400" id="submitButton">Mulai roasting</button>
        </form>

        <!-- Modal -->
       <div class="modal fade" id="roastModal" tabindex="-1" aria-labelledby="roastModalLabel" aria-hidden="true">
       <div class="modal-dialog modal-fullscreen-md-down modal-dialog-centered modal-dialog-scrollable">
       <div class="modal-content">
       <div class="modal-header px-4 py-4">
       <h5 class="modal-title" id="roastModalLabel">Hasil Roasting</h5>
       <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
       </div>
       <div class="modal-body">
       
       <div id="loading" class="d-flex align-items-center justify-content-center d-none" style="height: 100%;">
       <div class="spinner-border" role="status">
       <span class="visually-hidden">Loading...</span>
       </div>
       </div>
       
       <div class="mx-3 mt-3 pb-5" id="konten d-none">
       <img id="preview" src="https://images.pexels.com/photos/4029925/pexels-photo-4029925.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Foto Terkait"  class="rounded-2" style="opacity: 0; width: 100%; height: auto; object-fit: cover;" />
       <h3 class="f500 mx-1 mt-5 mb-3">Hasil Roasting</h3>
       <p id="roast" class="mx-1"></p>
       
       </div>


       </div>
       </div>
       </div>
       </div>
    </main>
    
    <section class="mb-5" id="fitur" style="margin-top: 80px;">
    
    <div class="container">
    <div class="mt-5 mb-5 mx-3 text-center">
    <p class="mb-2 f600 lh" style="font-size: 0.8rem; color: #A02BEA;">MARI ROASTING</p>
    <h1 class="mb-3 f500 lh-2">Ingin membuat teman tertawa atau hanya ingin menguji selera humormu sendiri</h1>
    <p class="f400 lh">Roasting Foto Pribadi. Unggah fotomu atau temanmu, dan lihat bagaimana kami mengubahnya menjadi lelucon yang memukau!</p>
    </div>
    <div class="row mx-2">
    <div class="col-12 col-md-4 mb-3">
    <div class="card p-3 rounded-4">
    <div class="card-body">
    <div class="card-icons">
    <!-- You can use Font Awesome or any other icon library here -->
    <img src="https://cdn-icons-png.flaticon.com/512/1161/1161490.png">
    </div>
    <h4 class="card-title f500">Apakah Aman?</h4>
    <p class="card-text f400 lh">Tentu saja! Keamanan privasi adalah prioritas kami. Foto yang kamu unggah tidak akan disimpan di server kami. Setelah roasting selesai, fotomu akan otomatis terhapus dari sistem kami, memastikan privasimu tetap terlindungi. Jadi, kamu bisa bersenang-senang tanpa khawatir!</p>
    </div>
    </div>
    </div>
    <div class="col-12 col-md-4 mb-3">
    <div class="card p-3 rounded-4">
    <div class="card-body">
    <div class="card-icons">
    <!-- You can use Font Awesome or any other icon library here -->
    <img src="https://cdn-icons-png.flaticon.com/512/2931/2931042.png">
    </div>
    <h4 class="card-title f500">Gratis 100%</h4>
    <p class="card-text f400 lh">Nikmati fitur ini sepenuhnya tanpa biaya. Kami percaya bahwa humor adalah hak setiap orang, dan kami ingin memastikan bahwa kamu bisa berbagi tawa tanpa harus mengeluarkan uang.</p>
    </div>
    </div>
    </div>
    </div>
    
    <div class="container">
    <footer class="py-3 my-4 text-center">
    <img src="images/logo.png" alt="Logo" class="navbar-logo mb-3">
    <ul class="nav justify-content-center border-bottom pb-3 mb-3">
    <li class="nav-item"><a href="#" class="nav-link px-2 text-body-secondary f400">Rumah</a></li>
    <li class="nav-item"><a href="#fitur" class="nav-link px-2 text-body-secondary f400">Fitur</a></li>
    <li class="nav-item"><a href="https://trakteer.id/zakiakaidzan/tip" class="nav-link px-2 text-body-secondary f400">Dukungan</a></li>
    <li class="nav-item"><a href="tentang" class="nav-link px-2 text-body-secondary f400">Tentang</a></li>
    </ul>
    <p class="text-center text-body-secondary f400">&copy; 2024 Roastgram</p>
    </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        const form = document.querySelector("form"), 
        const button = document.querySelector('form button');
        const photo = document.querySelector("#photo");
        const roast = document.querySelector("#roast");
        const loading = document.querySelector("#loading");
        const preview = document.querySelector("#preview");
        const fileNameDisplay = document.querySelector("#fileName");
        const konten = document.querySelector("#konten");
        const roastModal = new bootstrap.Modal(document.getElementById('roastModal'));

        photo.onchange = (evt) => {
            const [file] = photo.files;
            if (file) {
                preview.src = URL.createObjectURL(file);
                fileNameDisplay.textContent = file.name; // Tampilkan nama file
            } else {
                fileNameDisplay.textContent = ""; // Kosongkan nama file jika tidak ada file
            }
        };

        form.onsubmit = (e) => {
            e.preventDefault();
            roast.innerHTML = "";
            button.disabled = true;
            
            loading.classList.remove("d-none"); 
            
            roastModal.show(); // Tampilkan modal terlebih dahulu
            

            const data = new FormData();
            data.append("file", photo.files[0]);

            fetch("/roast", {
                method: "POST",
                body: data,
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.ok) {
                        preview.style.opacity = 1;
                        preview.style.height = "100%";
                         konten.classList.remove("d-none"); 
                         loading.classList.add("d-none");// Sembunyikan spinner loading
                        form.reset();
                        roast.innerHTML = marked.parse(data.text);
                    } else if (data.statusCode == 429) {
                        preview.style.opacity = 1;
                        preview.style.height = "100%";
                         konten.classList.remove("d-none"); 
                         loading.classList.add("d-none"); // Sembunyikan spinner loading
                        form.reset();
                        preview.src = '';
                        roast.innerHTML = `Traffic lagi rame, sabar sebentar pls ðŸ˜­ðŸ˜­<br><small>${data.message}</small>`;
                    } else {
                        konten.classList.remove("d-none"); 
                        loading.classList.add("d-none");
                        roast.innerHTML = "Roastingan terlalu brutal sampe kena sensor ðŸ”¥ðŸ”¥ðŸ’€ðŸ’€ðŸ¤£ðŸ¤£ðŸ¤£\nKlik Roast buat coba lagi";
                    }
                    button.disabled = false;
                })
                .catch((error) => {
                    console.error('Error:', error);
                    konten.classList.remove("d-none"); 
                    loading.classList.add("d-none");
                    roast.innerHTML = "Wah ada kesalahan maaf..";
                    button.disabled = false;
                });
        };
    </script>
</body>
</html>
